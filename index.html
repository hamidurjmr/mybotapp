<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tap & Earn — Limited (10–20 coins)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fff6f2; 
    --card: #ffffff;
    --accent1: #4facfe; 
    --accent2: #00f2fe;
    --warm1: #ff7676; 
    --warm2: #ffb476;
    --muted: #6b6b6b;
    --success: #4CAF50;
    --warning: #FF9800;
    --error: #F44336;
    --premium: #ff6b35;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
    color: #222;
    background: linear-gradient(180deg, var(--bg), #fff);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  .card {
    flex: 1;
    overflow: auto;
    padding: 16px;
  }
  
  header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }
  
  .logo {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    overflow: hidden;
  }
  
  .logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  
  .title {
    font-weight: 800;
    font-size: 18px;
  }
  
  .statusRow {
    margin-left: auto;
    display: flex;
    gap: 8px;
  }
  
  .pill {
    background: #f8f8f8;
    padding: 6px 12px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 14px;
  }
  
  .wheel-wrap {
    position: relative;
    width: 86vw;
    max-width: 320px;
    height: 86vw;
    max-height: 320px;
    margin: 18px auto;
  }
  
  .wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    transition: transform 4s cubic-bezier(.17,.67,.83,.67);
    box-shadow: 0 12px 30px rgba(0,0,0,0.06), inset 0 6px rgba(255,255,255,0.6);
  }
  
  .wheel.segs {
    background: conic-gradient(
      #ffd36e 0 45deg, 
      #ffb476 45deg 90deg, 
      #ff7676 90deg 135deg,
      #ffb6d1 135deg 180deg, 
      #a6e6c6 180deg 225deg, 
      #7fb4ff 225deg 270deg,
      #dfa6ff 270deg 315deg, 
      #ffd36e 315deg 360deg
    );
    border: 8px solid rgba(255,255,255,0.6);
  }
  
  .pointer {
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    width: 0;
    height: 0;
    border-left: 14px solid transparent;
    border-right: 14px solid transparent;
    border-bottom: 24px solid var(--warm1);
  }
  
  .center-coin {
    position: absolute;
    width: 88px;
    height: 88px;
    border-radius: 50%;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: #ffd36e;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 4px solid #fff;
    z-index: 6;
  }
  
  .center-coin img {
    width: 60px;
    height: 60px;
  }
  
  .label {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: 0 0;
    font-weight: 700;
    color: #1a1a1a;
    pointer-events: none;
  }
  
  .controls {
    display: flex;
    gap: 10px;
    margin-top: 14px;
  }
  
  .btn {
    flex: 1;
    padding: 12px;
    border-radius: 12px;
    border: 0;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .btn:active {
    transform: translateY(0);
  }
  
  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  .btn-watch {
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    color: #fff;
  }
  
  .btn-spin {
    background: linear-gradient(90deg, var(--warm1), var(--warm2));
    color: #fff;
  }
  
  .btn-premium {
    background: linear-gradient(90deg, var(--premium), #ff8c42);
    color: #fff;
    font-size: 12px;
    padding: 8px 12px;
  }
  
  .hint {
    text-align: center;
    font-size: 13px;
    color: var(--muted);
    margin-top: 10px;
  }
  
  .pop {
    position: fixed;
    left: 50%;
    top: 32%;
    transform: translate(-50%, -50%) scale(0);
    background: #fff;
    padding: 10px 16px;
    border-radius: 12px;
    font-weight: 800;
    box-shadow: 0 12px 30px rgba(0,0,0,0.12);
    transition: transform .25s;
    z-index: 120;
  }
  
  .pop.show {
    transform: translate(-50%, -50%) scale(1);
  }
  
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 110;
    visibility: hidden;
    opacity: 0;
    transition: opacity .2s;
  }
  
  .overlay.show {
    visibility: visible;
    opacity: 1;
  }
  
  .ovCard {
    background: #fff;
    padding: 18px;
    border-radius: 14px;
    max-width: 320px;
    text-align: center;
    width: 90%;
  }
  
  .meter {
    height: 12px;
    background: #eee;
    border-radius: 999px;
    margin-top: 14px;
    overflow: hidden;
  }
  
  .meter .bar {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #ffd36e, #ff7676);
    transition: width 0.1s linear;
  }
  
  .nav {
    display: flex;
    justify-content: space-around;
    background: #fff;
    box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
  }
  
  .nav button {
    flex: 1;
    padding: 12px;
    border: 0;
    background: none;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  .nav button:hover {
    background: #f5f5f5;
  }
  
  .nav button.active {
    color: var(--accent1);
  }
  
  .hidden {
    display: none;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
    font-size: 13px;
  }
  
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
  }
  
  .small {
    font-size: 12px;
    color: var(--muted);
  }
  
  .input-field {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
  }
  
  .input-field:focus {
    outline: none;
    border-color: var(--accent1);
  }
  
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    z-index: 1000;
    transform: translateX(150%);
    transition: transform 0.3s ease;
  }
  
  .notification.show {
    transform: translateX(0);
  }
  
  .notification.success {
    background-color: var(--success);
  }
  
  .notification.error {
    background-color: var(--error);
  }
  
  .notification.warning {
    background-color: var(--warning);
  }
  
  .spins-info {
    text-align: center;
    margin: 6px 0;
  }
  
  .progress-container {
    margin: 10px 0;
  }
  
  .progress-bar {
    height: 8px;
    background-color: #eee;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    width: 0%;
    transition: width 0.5s ease;
  }
  
  .wallet-section {
    margin-bottom: 20px;
  }
  
  .wallet-section h2, .wallet-section h3 {
    margin-bottom: 10px;
  }
  
  /* New Premium Section Styles - Small */
  .premium-card {
    background: linear-gradient(135deg, #fff8f6, #fff0eb);
    border: 1px solid var(--premium);
    border-radius: 8px;
    padding: 10px;
    margin: 10px 0;
    text-align: center;
    font-size: 12px;
  }
  
  .premium-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-bottom: 8px;
  }
  
  .premium-title {
    font-weight: 700;
    font-size: 14px;
    color: var(--premium);
  }
  
  .premium-badge {
    background: var(--premium);
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 9px;
    font-weight: 600;
  }
  
  .premium-price {
    font-size: 16px;
    font-weight: 800;
    color: var(--premium);
    margin: 6px 0;
  }
  
  .premium-benefits {
    text-align: left;
    margin: 8px 0;
    font-size: 11px;
  }
  
  .benefit-item {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
  }
  
  .benefit-icon {
    color: var(--premium);
    margin-right: 6px;
    font-weight: bold;
    font-size: 10px;
  }
  
  .address-container {
    background: #f8f8f8;
    padding: 8px;
    border-radius: 6px;
    margin: 8px 0;
    border: 1px solid #ddd;
  }
  
  .address {
    font-size: 10px;
    word-break: break-all;
    font-family: monospace;
    margin-bottom: 6px;
  }
  
  .copy-btn {
    background: rgba(255, 107, 53, 0.1);
    border: 1px solid var(--premium);
    color: var(--premium);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 10px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 3px;
  }
  
  .copy-btn:hover {
    background: rgba(255, 107, 53, 0.2);
  }
  
  .steps {
    margin: 8px 0;
  }
  
  .step {
    display: flex;
    margin-bottom: 6px;
    font-size: 11px;
  }
  
  .step-number {
    width: 16px;
    height: 16px;
    background: var(--premium);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    margin-right: 6px;
    flex-shrink: 0;
    font-size: 10px;
  }
  
  .highlight {
    color: var(--premium);
    font-weight: 600;
  }
</style>
</head>
<body>
<div class="card" id="spinPage">
  <header>
    <div class="logo">
      <img src="https://i.ibb.co/LDHjg19m/1000064821-removebg-preview.png" alt="Tap & Earn Logo">
    </div>
    <div>
      <div class="title">Tap & Earn</div>
    </div>
    <div class="statusRow">
      <div class="pill">Coins: <span id="points">0</span></div>
      <div class="pill">Lives: <span id="lives">0</span></div>
    </div>
  </header>

  <!-- Small Premium Ads Remove Card -->
  <div class="premium-card">
    <div class="premium-header">
      <div class="premium-title">🚫 Remove Ads</div>
      <span class="premium-badge">$16</span>
    </div>
    
    <div class="premium-benefits">
      <div class="benefit-item">
        <span class="benefit-icon">✓</span>
        <span>No ads after spins</span>
      </div>
      <div class="benefit-item">
        <span class="benefit-icon">✓</span>
        <span>No ads for lives</span>
      </div>
    </div>
    
    <div class="address-container">
      <div class="address">0x8Ed272B8003eC72F434929EB7E712dea2772A360</div>
      <div class="small">Send 16 USDT (BEP20)</div>
      <button class="copy-btn" onclick="copyAdsRemoveAddress()">
        📋 Copy
      </button>
    </div>
    
    <button class="btn btn-premium" onclick="contactTelegram()">
      Contact @HamidurYtG
    </button>
  </div>

  <div class="wheel-wrap">
    <div class="pointer" role="presentation"></div>
    <div id="wheel" class="wheel segs" role="presentation"></div>
    <div class="center-coin" role="presentation">
      <img src="https://i.ibb.co/LDHjg19m/1000064821-removebg-preview.png" alt="Coin">
    </div>
  </div>

  <div class="spins-info">
    <div class="pill">Daily spins left: <span id="spinsLeft">100</span></div>
    <div class="pill">Ads watched: <span id="adsWatched">0</span>/100</div>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar">
      <div id="spinsProgress" class="progress-fill"></div>
    </div>
    <div class="small">Daily progress: <span id="spinsProgressText">0%</span></div>
  </div>

  <div class="controls">
    <button id="watchBtn" class="btn btn-watch">▶️ Watch (Get 1 Life)</button>
    <button id="spinBtn" class="btn btn-spin">🎯 Spin (Use 1 Life)</button>
  </div>
  
  <div class="hint">Spin the wheel to earn coins (10-20 per spin)</div>
</div>

<!-- Wallet Page -->
<div class="card hidden" id="walletPage">
  <div class="wallet-section">
    <h2>Wallet</h2>
    <p>Balance: <b><span id="usdtBalance">0</span> USDT (BEP20)</b></p>
    <button id="convertBtn" class="btn btn-spin">Convert 5000 Coins → 5 USDT (BEP20)</button>
  </div>
  
  <div class="wallet-section">
    <h3>Withdraw</h3>
    <input id="walletAddr" class="input-field" placeholder="Wallet Address (BEP20)">
    <input id="withdrawAmt" class="input-field" placeholder="Amount (min 50 USDT)" type="number" min="50">
    <button id="withdrawBtn" class="btn btn-watch">Withdraw</button>
  </div>

  <div class="wallet-section">
    <h3>History</h3>
    <table>
      <thead>
        <tr>
          <th>Address</th>
          <th>Amount (USDT BEP20)</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>
  </div>
</div>

<div class="nav">
  <button id="spinNavBtn" onclick="showPage('spin')" class="active">🎡 Spin</button>
  <button id="walletNavBtn" onclick="showPage('wallet')">💰 Wallet</button>
</div>

<!-- Notification -->
<div id="notification" class="notification"></div>

<!-- Try real ad SDK first (kept) -->
<script src='//libtl.com/sdk.js' data-zone='9857499' data-sdk='show_9857499'></script>

<!-- Overlay (no cancel) -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="ovCard">
    <div id="ovText">Watching ad... Don't close (14s)</div>
    <div class="meter">
      <div id="bar" class="bar"></div>
    </div>
    <div class="small" id="timeLeft">14 seconds remaining</div>
  </div>
</div>

<div id="pop" class="pop" aria-hidden="true">+0</div>

<script>
(function(){
  // Settings: updated per your request
  const REQUIRED_MS = 14000;      // watch time to get 1 life (14s) - increased from 10s
  const AFTER_SPIN_AD_MS = 8000;  // interstitial duration after spin (8s)
  const DAILY_MAX_SPINS = 100;    // daily spin limit
  const DAILY_MAX_ADS = 100;      // daily ad watch limit - same as spins
  // Reward segments (10 to 20 only) - reduced as requested
  const segments = [10, 12, 14, 16, 18, 20, 10, 12];
  const segCount = segments.length;

  // UI refs
  const pointsEl = document.getElementById('points'),
        livesEl = document.getElementById('lives'),
        spinsLeftEl = document.getElementById('spinsLeft'),
        adsWatchedEl = document.getElementById('adsWatched'),
        spinsProgress = document.getElementById('spinsProgress'),
        spinsProgressText = document.getElementById('spinsProgressText'),
        wheel = document.getElementById('wheel'),
        watchBtn = document.getElementById('watchBtn'),
        spinBtn = document.getElementById('spinBtn'),
        overlay = document.getElementById('overlay'),
        bar = document.getElementById('bar'),
        ovText = document.getElementById('ovText'),
        timeLeftEl = document.getElementById('timeLeft'),
        pop = document.getElementById('pop'),
        usdtBalanceEl = document.getElementById('usdtBalance'),
        convertBtn = document.getElementById('convertBtn'),
        withdrawBtn = document.getElementById('withdrawBtn'),
        historyBody = document.getElementById('historyBody'),
        notification = document.getElementById('notification'),
        spinNavBtn = document.getElementById('spinNavBtn'),
        walletNavBtn = document.getElementById('walletNavBtn');

  // storage keys
  const K_POINTS='points',K_LIVES='lives',K_DATE='date',K_COUNT='count',K_USDT='usdt',K_HIST='history',K_PREMIUM='premium',K_ADS_WATCHED='ads_watched';

  // load safe
  let points = Number(localStorage.getItem(K_POINTS)) || 0;
  let lives = Number(localStorage.getItem(K_LIVES)) || 0;
  let usdt = Number(localStorage.getItem(K_USDT)) || 0;
  let isPremium = localStorage.getItem(K_PREMIUM) === 'true';
  let adsWatched = Number(localStorage.getItem(K_ADS_WATCHED)) || 0;

  function today(){ 
    const d = new Date(); 
    return d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate(); 
  }
  
  let date = localStorage.getItem(K_DATE), count = Number(localStorage.getItem(K_COUNT)) || 0;
  if(date !== today()){ 
    date = today(); 
    count = 0; 
    adsWatched = 0;
    localStorage.setItem(K_DATE, date); 
    localStorage.setItem(K_COUNT, count); 
    localStorage.setItem(K_ADS_WATCHED, adsWatched);
  }

  function refreshUI(){
    pointsEl.textContent = points;
    livesEl.textContent = lives;
    const spinsLeft = Math.max(0, DAILY_MAX_SPINS - count);
    const adsLeft = Math.max(0, DAILY_MAX_ADS - adsWatched);
    spinsLeftEl.textContent = spinsLeft;
    adsWatchedEl.textContent = adsWatched;
    
    // Update progress bar
    const progressPercent = (count / DAILY_MAX_SPINS) * 100;
    spinsProgress.style.width = `${progressPercent}%`;
    spinsProgressText.textContent = `${Math.round(progressPercent)}%`;
    
    usdtBalanceEl.textContent = usdt.toFixed(2);
    spinBtn.disabled = (lives <= 0 || count >= DAILY_MAX_SPINS);
    watchBtn.disabled = (adsWatched >= DAILY_MAX_ADS);
    convertBtn.disabled = (points < 5000);
    
    // Hide premium card if user is already premium
    if(isPremium) {
      document.querySelector('.premium-card').style.display = 'none';
    }
  }
  refreshUI();

  // draw labels
  function drawLabels(){
    wheel.querySelectorAll('.label').forEach(n => n.remove());
    const w = wheel.clientWidth, h = wheel.clientHeight, cx = w/2, cy = h/2;
    const r = Math.min(w, h) * 0.32;
    
    for(let i = 0; i < segCount; i++){
      const angle = (360/segCount) * i + (360/segCount)/2;
      const rad = (angle - 90) * Math.PI/180;
      const x = cx + Math.cos(rad) * r, y = cy + Math.sin(rad) * r;
      const el = document.createElement('div');
      el.className = 'label'; 
      el.textContent = segments[i];
      el.style.left = x + 'px'; 
      el.style.top = y + 'px';
      el.style.fontSize = Math.max(12, Math.floor(w/20)) + 'px';
      el.style.transform = "translate(-50%, -50%)";
      wheel.appendChild(el);
    }
  }
  
  setTimeout(() => { 
    try { 
      drawLabels(); 
    } catch(e) {} 
  }, 50);
  
  window.onresize = () => setTimeout(() => { 
    try { 
      drawLabels(); 
    } catch(e) {} 
  }, 120);

  function showPop(txt){ 
    pop.textContent = txt; 
    pop.classList.add('show'); 
    setTimeout(() => pop.classList.remove('show'), 1200); 
  }
  
  function showNotification(message, type = 'success') {
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.classList.add('show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  // spinning logic
  let spinning = false, rot = 0;
  function spin(){
    if(spinning) return;
    if(lives <= 0){ 
      showNotification('No lives available', 'error');
      return; 
    }
    if(count >= DAILY_MAX_SPINS){ 
      showNotification('Daily spin limit reached', 'warning');
      return; 
    }

    spinning = true; 
    spinBtn.disabled = true;

    lives--; 
    localStorage.setItem(K_LIVES, lives);

    const idx = Math.floor(Math.random() * segCount), 
          seg = 360/segCount, 
          deg = idx * seg + seg/2;
    const full = 4 + Math.floor(Math.random() * 3);
    const final = full * 360 + (360 - deg);
    rot = rot + final;
    wheel.style.transition = "transform 3.5s cubic-bezier(.17,.67,.83,.67)";
    wheel.style.transform = `rotate(${rot}deg)`;

    setTimeout(() => {
      let gain = Number(segments[idx]) || 0;
      
      // Double coins for premium users
      if(isPremium) {
        gain *= 2;
      }
      
      points += gain; 
      localStorage.setItem(K_POINTS, points);
      count++; 
      localStorage.setItem(K_COUNT, count);
      refreshUI();
      showPop("+" + gain);
      spinning = false; 
      spinBtn.disabled = false;

      // Skip ads for premium users
      if(!isPremium) {
        showInterstitialAdWithFallback(AFTER_SPIN_AD_MS);
      }
    }, 3600);
  }
  
  spinBtn.addEventListener('click', spin);

  // overlay ad timer (no cancel)
  let timer = null;
  let adStartTime = null;
  let adCompleted = false;
  
  function clearTimer(){ 
    if(timer){ 
      clearInterval(timer); 
      timer = null; 
    } 
  }

  // Detect if user tries to leave the page during ad
  function setupAdLeaveDetection() {
    window.addEventListener('beforeunload', handleAdLeave);
    window.addEventListener('blur', handleAdLeave);
    document.addEventListener('visibilitychange', handleVisibilityChange);
  }
  
  function removeAdLeaveDetection() {
    window.removeEventListener('beforeunload', handleAdLeave);
    window.removeEventListener('blur', handleAdLeave);
    document.removeEventListener('visibilitychange', handleVisibilityChange);
  }
  
  function handleAdLeave(e) {
    if (!adCompleted && adStartTime) {
      const timeWatched = Date.now() - adStartTime;
      if (timeWatched < REQUIRED_MS) {
        // User left before completing ad
        showNotification('Ad not completed. No life awarded.', 'error');
        adCompleted = true;
        clearTimer();
        overlay.classList.remove('show');
        removeAdLeaveDetection();
        return true;
      }
    }
  }
  
  function handleVisibilityChange() {
    if (document.hidden && !adCompleted && adStartTime) {
      const timeWatched = Date.now() - adStartTime;
      if (timeWatched < REQUIRED_MS) {
        // User switched tabs/windows
        showNotification('Please complete the ad to get life', 'warning');
      }
    }
  }

  // Try to show SDK interstitial; if SDK not available or doesn't close within given timeout, use fallback simulated overlay.
  function showInterstitialAdWithFallback(timeoutMs){
    let sdkCalled = false;
    try{
      if(typeof show_9857499 === 'function'){
        try{ 
          show_9857499(); 
        } catch(e) {}
        sdkCalled = true;
      }
    } catch(e){ 
      sdkCalled = false; 
    }

    overlay.classList.add('show'); 
    ovText.textContent = 'Showing ad... please wait'; 
    bar.style.width = '0%';
    clearTimer();
    const start = Date.now();
    timer = setInterval(() => {
      const elapsed = Date.now() - start;
      const p = (elapsed / timeoutMs) * 100;
      bar.style.width = Math.min(100, p) + '%';
      if(elapsed >= timeoutMs){
        clearTimer(); 
        overlay.classList.remove('show');
        refreshUI();
      }
    }, 150);
  }

  // Watch-to-get-life: try rewarded SDK first, else fallback to overlay timer that rewards after REQUIRED_MS
  function startWatchForLife(){
    // Skip for premium users
    if(isPremium) {
      lives++; 
      localStorage.setItem(K_LIVES, lives); 
      refreshUI(); 
      showPop('+1 life');
      showNotification('Life added successfully!', 'success');
      return;
    }

    // Check daily ad limit
    if(adsWatched >= DAILY_MAX_ADS) {
      showNotification('Daily ad limit reached', 'warning');
      return;
    }

    try{
      if(typeof show_9857499 === 'function'){
        try{ 
          show_9857499(); 
        } catch(e){}
      }
    } catch(e){}

    overlay.classList.add('show'); 
    ovText.textContent = 'Watching ad (reward)... please wait'; 
    bar.style.width = '0%';
    adStartTime = Date.now();
    adCompleted = false;
    
    // Setup detection for user leaving ad
    setupAdLeaveDetection();
    
    clearTimer();
    const start = Date.now();
    timer = setInterval(() => {
      const elapsed = Date.now() - start;
      const p = (elapsed / REQUIRED_MS) * 100;
      const secondsLeft = Math.ceil((REQUIRED_MS - elapsed) / 1000);
      bar.style.width = Math.min(100, p) + '%';
      timeLeftEl.textContent = secondsLeft + ' seconds remaining';
      
      if(elapsed >= REQUIRED_MS){
        clearTimer(); 
        overlay.classList.remove('show');
        removeAdLeaveDetection();
        
        // Only reward if user didn't leave early
        if (!adCompleted) {
          adCompleted = true;
          lives++; 
          adsWatched++;
          localStorage.setItem(K_LIVES, lives); 
          localStorage.setItem(K_ADS_WATCHED, adsWatched);
          refreshUI(); 
          showPop('+1 life');
          showNotification('Life added successfully!', 'success');
        }
      }
    }, 150);
  }

  watchBtn.addEventListener('click', () => { 
    startWatchForLife(); 
  });

  // wallet conversion
  convertBtn.addEventListener('click', () => {
    if(points >= 5000){
      points -= 5000; 
      usdt += 5;
      localStorage.setItem(K_POINTS, points); 
      localStorage.setItem(K_USDT, usdt);
      refreshUI(); 
      showPop('+5 USDT');
      showNotification('Conversion successful!', 'success');
    } else {
      showNotification('Not enough coins to convert. You need 5000 coins.', 'error');
    }
  });

  // withdraw history
  function loadHistory(){ 
    try{ 
      return JSON.parse(localStorage.getItem(K_HIST) || "[]"); 
    } catch(e){ 
      return []; 
    } 
  }
  
  function saveHistory(h){ 
    localStorage.setItem(K_HIST, JSON.stringify(h)); 
  }
  
  function renderHistory(){
    const h = loadHistory(); 
    historyBody.innerHTML = '';
    const now = Date.now();
    
    if (h.length === 0) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="3">No withdrawal history</td>`;
      historyBody.appendChild(tr);
      return;
    }
    
    h.forEach(item => {
      if(item.status === "Pending" && now - item.time >= 72 * 3600 * 1000){ 
        item.status = "Completed"; 
      }
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.addr.substring(0, 6)}...${item.addr.substring(item.addr.length - 4)}</td>
        <td>${item.amount} USDT (BEP20)</td>
        <td>${item.status}</td>
      `;
      historyBody.appendChild(tr);
    });
    saveHistory(h);
  }

  withdrawBtn.addEventListener('click', () => {
    const addr = document.getElementById('walletAddr').value.trim();
    const amt = Number(document.getElementById('withdrawAmt').value);
    
    if(!addr) {
      showNotification('Please enter a wallet address', 'error');
      return;
    }
    
    if(isNaN(amt) || amt < 50) {  // Changed from 20 to 50
      showNotification('Minimum withdrawal amount is 50 USDT', 'error');
      return;
    }
    
    if(amt > usdt) {
      showNotification('Insufficient USDT balance', 'error');
      return;
    }
    
    usdt -= amt; 
    localStorage.setItem(K_USDT, usdt); 
    refreshUI();
    const h = loadHistory(); 
    h.push({
      addr, 
      amount: amt, 
      status: "Pending", 
      time: Date.now()
    }); 
    saveHistory(h); 
    renderHistory();
    document.getElementById('walletAddr').value = ''; 
    document.getElementById('withdrawAmt').value = '';
    showNotification('Withdrawal request submitted!', 'success');
  });
  
  // New functions for premium features
  function copyAdsRemoveAddress() {
    const address = '0x8Ed272B8003eC72F434929EB7E712dea2772A360';
    navigator.clipboard.writeText(address).then(() => {
      showNotification('Address copied to clipboard!', 'success');
    }).catch(err => {
      showNotification('Failed to copy address', 'error');
    });
  }
  
  function contactTelegram() {
    window.open('https://t.me/HamidurYtG', '_blank');
  }
  
  function activatePremium() {
    isPremium = true;
    localStorage.setItem(K_PREMIUM, 'true');
    refreshUI();
    showNotification('Premium activated! Ads removed and benefits applied.', 'success');
  }
  
  // Simulate premium activation (in real app, this would happen after payment verification)
  // For demo purposes, you can call activatePremium() after payment
  
  renderHistory();

  // page switch
  window.showPage = function(p){
    document.getElementById('spinPage').classList.add('hidden');
    document.getElementById('walletPage').classList.add('hidden');
    spinNavBtn.classList.remove('active');
    walletNavBtn.classList.remove('active');
    
    if(p === 'spin') {
      document.getElementById('spinPage').classList.remove('hidden');
      spinNavBtn.classList.add('active');
    }
    
    if(p === 'wallet') {
      document.getElementById('walletPage').classList.remove('hidden');
      walletNavBtn.classList.add('active');
      renderHistory();
    }
  }
  
  showPage('spin');

  // starter coins
  if(!localStorage.getItem('limited_welcome')){
    points += 50; 
    localStorage.setItem(K_POINTS, points); 
    localStorage.setItem('limited_welcome','1');
    showPop('+50 starter'); 
    refreshUI();
    showNotification('Welcome! You received 50 starter coins.', 'success');
  }
})();
</script>
</body>
</html>
<script type="text/javascript">
	atOptions = {
		'key' : '685d1ff544ce6c055f9da7adc093768e',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/685d1ff544ce6c055f9da7adc093768e/invoke.js"></script>
